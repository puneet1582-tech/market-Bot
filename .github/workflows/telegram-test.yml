name: Telegram NIFTY Bot

on:
  schedule:
    - cron: "30 3 * * *"
  workflow_dispatch:

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:
      - name: Get NIFTY price and send to Telegram
        run: |
          python - <<EOF
          import requests
          import os
          import csv
          from io import StringIO

          token = os.environ["BOT_TOKEN"]
          chat_id = os.environ["CHAT_ID"]

          url = "https://query1.finance.yahoo.com/v7/finance/download/%5ENSEI?period1=0&period2=9999999999&interval=1d&events=history&includeAdjustedClose=true"
          resp = requests.get(url)
          data = resp.text

          reader = csv.DictReader(StringIO(data))
          rows = list(reader)
          last = rows[-1]
          price = last["Close"]

          message = f"ðŸ“Š NIFTY LIVE UPDATE\nNIFTY Price: â‚¹{price}\nRisk management à¤œà¤¼à¤°à¥‚à¤°à¥€ à¤¹à¥ˆ"

          send_url = f"https://api.telegram.org/bot{token}/sendMessage"
          requests.post(send_url, data={"chat_id": chat_id, "text": message})
          EOF
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
