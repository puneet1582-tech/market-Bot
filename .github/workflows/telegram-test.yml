name: Telegram NIFTY Bot

on:
  schedule:
    - cron: "30 3 * * *"
  workflow_dispatch:

jobs:
  send-message:
    runs-on: ubuntu-latest
    steps:
      - name: Get NIFTY price and send to Telegram
        run: |
          python - <<EOF
          import requests
          import os

          token = os.environ["BOT_TOKEN"]
          chat_id = os.environ["CHAT_ID"]

          url = "https://query1.finance.yahoo.com/v7/finance/quote?symbols=%5ENSEI"
          data = requests.get(url).json()

          price = data["quoteResponse"]["result"][0]["regularMarketPrice"]

          message = f"ðŸ“Š NIFTY LIVE UPDATE\nNIFTY Price: â‚¹{price}\nRisk management à¤œà¤¼à¤°à¥‚à¤°à¥€ à¤¹à¥ˆ"

          send_url = f"https://api.telegram.org/bot{token}/sendMessage"
          requests.post(send_url, data={"chat_id": chat_id, "text": message})
          EOF
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
